{% extends "base.html" %}
{% load data_dashboard_tags %}
{% load url from future %}

{% block fulltitle %}OpenRural: {{ scraper }}{% endblock %}

{% block content %}
<h1>{{ scraper }}</h1>

{% if schema %}
<table>
    <tr>
        <th>Name</th>
        <td>{{ schema.plural_name|capfirst }}</td>
    </tr>
    <tr>
        <th>News Items</th>
        <td>
            {% with schema.newsitem_set.count as count %}
                {{ count }}
                {% if count > 0 %}(<a href="{% url 'delete_scraper_news_items' scraper.slug %}">delete all</a>){% endif %}
            {% endwith %}
        </td>
    </tr>
    <tr>
        <th>Failures</th>
        <td><a href='{% url 'list_failures' scraper.slug %}'>{{ num_failures }}</a></td>
    </tr>
</table>
{% endif %}

<form action='{% url "run_scraper" scraper.slug %}' method='post'>
    {% csrf_token %}
    <input type='submit' name='submit' value='Run' />
</form>

<form action='' method='get'>
    <button type='submit' name='show_skipped' value='{{ show_skipped }}'>
        {% if show_skipped %}Show{% else %}Hide{% endif %} Skipped Runs
    </button>
</form>

<table>
    <tr>
        <th>Name</th>
        <th>Date</th>
        <th>Status</th>
        <th>End Date</th>
        <th>Duration</th>
    </tr>
    {% for run in runs %}
        <tr>
            <td>{{ run.id }}</td>
            <td>{{ run.date }}</td>
            <td><a href='{% url "view_run" scraper.slug run.pk %}'>{{ run.get_status_display }}</a></td>
            <td>
            {% if run.end_date %}
                <a href='{% url "list_failures" scraper.slug run.pk %}'>{{ run.end_date }}</a>
            {% endif %}
            </td>
            <td>{{ run.duration|duration }}</td>
        </tr>
    {% endfor %}
</table>
{% endblock %}
